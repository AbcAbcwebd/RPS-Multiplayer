<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<title>Rock Paper Scissors - Online Multiplayer</title>
	<script src="https://code.jquery.com/jquery-3.1.1.js"></script>
	<script src="assets/javascript/app.js"></script>
	<link rel="stylesheet" type="text/css" href="assets/css/reset.css">
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>
<body>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
	    apiKey: "AIzaSyAL9qWQ1BQ1YJzIlDCGKG05Nu_-fZcaLYU",
	    authDomain: "obe-rock-paper-scissors.firebaseapp.com",
	    databaseURL: "https://obe-rock-paper-scissors.firebaseio.com",
	    projectId: "obe-rock-paper-scissors",
	    storageBucket: "obe-rock-paper-scissors.appspot.com",
	    messagingSenderId: "291973353413"
	  };
	  firebase.initializeApp(config);
	</script>
	<div id="account-display"></div>

	<script>
		getUserName();

		var database = firebase.database();
		var currentUser;
		var activeUserPath;
		var currentUserCount = 0;
/*
		database.ref().on("value", function(snapshot){
			console.log(snapshot.val().activeUsers);
		}, function(error){
			console.log(error);
		});
*/
		function addActiveUserData(newUser) {
		  firebase.database().ref('activeUsers/user' + (currentUserCount + 1)).set({
		    name: newUser
		  });
		  currentUser = newUser;
		  activeUserPath = firebase.database().ref('activeUsers/' + currentUser)
		  activeUserPath.onDisconnect().remove();
		};
/*
		function removeActiveUser() {
			alert("Disconnecting")
			if (currentUser.length > 0){
				firebase.database().ref('activeUsers/' + currentUser).remove();
			};
		};
*/
		// Click functionality goes here
		$( document ).ready(function() {
			$("#set-name-button").on("click", function() {
				event.preventDefault();
				var userInput = $('#name-input').val();
				// Validates user input
				if (userInput.length === 0) {
					$('#error-display').text("Please enter a valid screen name.");
				} else {
					// Ideally there should be an additional else if statement that validates that the chosen name is unique. 

					addActiveUserData(userInput);
					moveOffPage("account-display");
				};
				
			});
		});

		Object.size = function(obj) {
		    var size = 0, key;
		    for (key in obj) {
		        if (obj.hasOwnProperty(key)) size++;
		    }
		    return size;
		};

		// Get the size of an object
//		var size = Object.size(myArray);

		database.ref('activeUsers/').on("value", function(snapshot){
			var activeUsersObj = snapshot.val();
			currentUserCount = Object.size(activeUsersObj);
			console.log("Number of users: " + currentUserCount);
			console.log(activeUsersObj);
		}, function(error){
			console.log(error);
		});

	</script>
</body>
</html>